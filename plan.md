# pickit 実行計画

このドキュメントは、`pickit` の開発計画と進捗を記録します。

---

## パフォーマンス改善計画

### Step 1: Git Status チェックの最適化 (完了)

**問題点:**
`app::refresh` 処理において、リポジトリ内の全ディレクトリに対して `git status` コマンドを個別に実行しており、大規模リポジトリで著しいパフォーマンス低下を引き起こしていました。

**改善内容:**
-   `git.rs` を修正し、`git status --porcelain=v1` を一度だけ呼び出してリポジトリ全体の変更状態を取得する `get_uncommitted_paths` 関数を実装しました。
-   `app.rs` の `refresh` 関数を修正し、`get_uncommitted_paths` から得た変更リストをメモリ上でチェックするようにロジックを変更しました。
-   これにより、`git` プロセスの呼び出し回数がディレクトリ数から1回に削減され、初期化時間が大幅に短縮されました。
-   この変更はコミット `12ee8f7` (`perf: Optimize git status check`) で `main` ブランチにマージ済みです。

### Step 2: ファイル一覧取得の高速化 (今後の計画)

**問題点:**
現在の `git::get_all_dirs` 関数は、`git ls-tree` コマンドを実行してディレクトリ一覧を取得しています。これは `git` プロセスを呼び出すため、依然としてオーバーヘッドが存在します。

**改善計画:**
-   `git ls-tree` の呼び出しを、Rust の高速なファイルシステムウォークライブラリである `jwalk` と `ignore` に置き換えます。
-   `jwalk::WalkBuilder` を使用して、マルチスレッドでディレクトリ構造を並列にスキャンします。
-   `ignore` クレートと連携し、`.gitignore` ファイルのルールを適用して、Git が無視するファイルを走査対象から除外します。
-   これにより、`git` プロセスの呼び出しを完全に排除し、さらなる初期化時間の短縮を目指します。
