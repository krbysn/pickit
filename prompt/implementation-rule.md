# pickit 実装ルール案

## 1. 言語・ツール
- **Rust Edition:** 2021
- **ビルドツール:** `cargo` を全面的に利用します (build, test, format, clippy)。
- **TUIライブラリ:** [Ratatui](https://ratatui.rs/) を利用します。柔軟なレイアウト構築と豊富なコンポーネントが要件に適しています。
- **CLI引数解析:** [Clap](https://crates.io/crates/clap) を利用し、型安全な引数解析を実装します。

## 2. コーディング規約
- **フォーマット:** `cargo fmt` を必須とします。CIでのチェックを推奨します。
- **静的解析:** `cargo clippy -- -D warnings` を必須とします。Clippyの警告(warnings)はエラーとして扱い、コード品質を高く維持します。
- **エラーハンドリング:**
    - `Result` を用いたエラー伝播を基本とします。
    - [thiserror](https://crates.io/crates/thiserror) を利用して、アプリケーション固有のカスタムエラー型を定義し、Gitコマンドのエラー、I/Oエラーなどを明確に区別します。

## 3. Git連携
- Rustの標準ライブラリ `std::process::Command` を利用して `git` コマンドを実行します。
- 外部クレートへの依存を減らし、移植性を高く保ちます。
- コマンドの実行結果（stdout, stderr, 終了コード）を適切にハンドリングし、エラーは独自のエラー型に変換します。

## 4. テスト
- **ユニットテスト:** `git` コマンドの出力結果をパースするロジックや、ツリー構造を管理するロジックなど、UIから分離可能なビジネスロジックを中心に記述します。
- **TUIのテスト:** TUIコンポーネントのテストは困難なため、UI表示に関わるロジックは最小限にし、状態管理ロジックを分離してテストカバレッジを確保します。

## 5. コミット・Pull Request (PR)
- **ブランチ戦略:**
    - `main` ブランチを保護ブランチとし、直接のプッシュは禁止します。
    - 各PRに対して、`main` ブランチから新しいフィーチャーブランチを作成します。
- **ブランチ命名規則:**
    - ブランチ名は `feature/PR<#>-<簡潔な説明>` の形式とします。
    - 例: `feature/PR1-git-module`, `feature/PR2-tui-skeleton`
- **コミットメッセージ:** [Conventional Commits](https://www.conventionalcommits.org/) の規約に準拠します。
    - 例: `feat:`, `fix:`, `refactor:`, `docs:`, `test:`
- **PRの単位:** 後述の `plan.md` に記載された単位でPRを作成します。各PRは小さく、焦点を絞ったものにします。
- **ブランチの作成タイミング** PR作業の開始タイミングで作業完了を報告するタイミングでコミットします。
- **レビュー:** 全てのPRは、CIのチェックをパスし、レビュアーの承認を得てからマージします。

## 6. アーキテクチャ
- **アプリケーションファサードパターン:** TUIに依存したテストの複雑化を避けるため、以下の3層アーキテクチャを採用します。
    1.  **TUI Layer (UI層):** 描画とユーザー入力の解釈に専念。
    2.  **App Facade Layer (アプリケーション層):** UIに依存しない全ての状態とビジネスロジックを管理。
    3.  **Git Module (データ層):** Gitコマンドの実行と結果のパースに専念。
- **採用理由:** この構成は、メリット（テスト容易性、関心の分離、保守性）が、デメリット（初期コード量の微増）を大幅に上回ると判断したためです。特に、アプリケーションのコアロジックをUIから完全に分離し、ユニットテストを容易にすることが最大の目的です。
