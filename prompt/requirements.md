# pickit アプリケーション要求 (高機能UI版)

## 1. 概要
- pickitはgitの `sparse-checkout` の **`cone` モード** を対話的に管理するためのTUIアプリケーションです。
- カラー表示とマルチパネルUIを前提とし、ディレクトリのチェックアウト状態とサブディレクトリの情報を視覚的に分かりやすく表示します。

## 2. 機能要件

### 2.1. 基本機能
- **クロスプラットフォーム対応:** Linux, macOS, Windowsで動作します。
- **Rust製:** パフォーマンスと安全性を確保します。
- **git CLI連携:** `git sparse-checkout` の `cone` モードに関するコマンドを内部で実行します。

### 2.2. TUI (Text-based User Interface)
- UIは大きく3つのパネルで構成されます: **ツリービュー** (左)、**グリッドビュー** (右)、**フッター** (下部)。

#### 2.2.1. ツリービュー (左パネル)
- リポジトリの**ディレクトリのみ**で構成されるツリーを表示します。
- 各ディレクトリの状態を、色と記号の組み合わせで表現します。

##### 記号の定義
- **状態記号 (Item State):** アイテム自身の現在の状態を示します。
    - `✔`: 現在チェックアウト対象となっている。
    - `☐`: 現在チェックアウト対象となっていない。
    - `+`: チェックアウト対象として選択された (変更適用待ち)。
    - `-`: チェックアウト除外対象として選択された (変更適用待ち)。
    - `🔒`: 状態を変更できない (ロック状態)。
- **展開記号 (Expansion):** サブディレクトリの有無と展開状態を示します。
    - `▸`: サブディレクトリがあり、現在折りたたまれている。
    - `▾`: サブディレクトリがあり、現在展開されている。
    - (なし): サブディレクトリが存在しない。
- **内包記号 (Containment Symbol):**
    - `·`: チェックアウトされていない (`☐`) ディレクトリが、その下位にチェックアウト済みのディレクトリを含んでいることを示す。

##### カラーの定義 (ディレクトリ名)
- **緑 (Green):** チェックアウトされている (`✔`)。
- **白 (White):** チェックアウトされていないが(`☐`)、下位にチェックアウト済みのディレクトリを含む (`·`)。
- **灰色 (Gray):** チェックアウトされておらず (`☐`)、下位にもチェックアウト済みのディレクトリを含まない。
- **黄 (Yellow):** 変更が適用待ちの状態 (`+` or `-`)。
- **赤 (Red):** ロックされている (`🔒`)。
- **青 (Blue):** カーソルが現在置かれている行 (選択中)。

#### 2.2.2. グリッドビュー (右パネル)
- ツリービューで選択されているディレクトリの、詳細情報を表示します。
- **表示項目:**
    - `Name`: ディレクトリ名
    - `Path`: リポジトリルートからのパス
    - `Status`: チェックアウト状態 (`Checked Out`, `Not Checked Out`, `Locked`)
    - `Uncommitted`: 未コミットの変更の有無 (`Yes` / `No`)
    - `Subdirectories`:
        - `Total`: 直下のサブディレクトリ総数
        - `Checked Out`: チェックアウト済みの数
    - `Pending Changes`: このディレクトリ以下で適用待ちの変更数

#### 2.2.3. 操作
- `Tab`: ツリービューとグリッドビューのフォーカスを切り替えます (将来的な機能拡張用)。
- `Space` キー: `🔒` 状態でないディレクトリのチェックアウト/除外を選択/解除します。
- `a` (Apply) キー: 選択した変更 (`+` と `-`) を `git sparse-checkout set` コマンドで実行します。

## 3. 画面レイアウト案

```
 pickit - /path/to/your/repo
+--------------------------------+----------------------------------------+
| Tree View                      | Grid View (info for 'src')             |
|                                |                                        |
| ▸ ☐ docs                       | Name:          src                     |
| ▸ ✔ src                        | Path:           /src                    |
| ▾ + dist                       | Status:         Checked Out           |
|   ▸ ☐ sub-dist                 | Uncommitted:    No                      |
| ▸ 🔒 tests                     | Subdirectories:                        |
|                                |   Total:        2                       |
|                                |   Checked Out:  1                       |
|                                | Pending Changes: 1                     |
|                                |                                        |
+--------------------------------+----------------------------------------+
 [↑/↓] Navigate [→/←] Expand/Collapse [Space] Toggle [a] Apply [q] Quit
```
*(上記の例では、`src` ディレクトリがツリービューで選択されている状態を示しています)*

## 4. 注意事項
`pickit` はUI上でエラーを未然に防ぐ設計を取りますが、以下の点は考慮が必要です。

- **未コミットの変更:** 未コミットの変更を含むディレクトリは `🔒` (Locked) 状態となり、チェックアウトの除外を選択できなくなります。この情報はグリッドビューでも明示されます。
- **追跡されていないファイル:** 追跡されていないファイルが存在するディレクトリをチェックアウトから除外した場合、それらのファイルは作業ディレクトリに残り続けます。
